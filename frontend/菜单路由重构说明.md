# DRMP 菜单路由重构说明

## 概述
本次重构实现了基于用户类型的动态菜单和路由系统，支持管理员、案源机构、处置机构三种不同用户类型的差异化界面。

## 新增文件结构

### 配置文件
- `/src/config/menuConfig.ts` - 菜单配置，定义三种用户类型的菜单结构
- `/src/config/routeConfig.tsx` - 路由配置，定义三种用户类型的路由映射

### 布局组件
- `/src/components/layout/SideMenu.tsx` - 动态侧边菜单组件
- `/src/components/layout/AppRouter.tsx` - 应用路由组件
- `/src/components/layout/BreadcrumbNav.tsx` - 面包屑导航组件

## 功能特性

### 1. 三种用户类型支持
- **管理员 (admin)**: 完整的系统管理功能
- **案源机构 (source_org)**: 案件发布和合作管理
- **处置机构 (disposal_org)**: 案件处置和业绩管理

### 2. 动态菜单系统
- 根据用户类型自动加载对应菜单
- 支持多级菜单嵌套
- 自动高亮当前页面菜单项
- 支持菜单折叠/展开

### 3. 智能路由管理
- 基于用户类型的路由权限控制
- 懒加载组件提升性能
- 自动重定向未授权访问

### 4. 面包屑导航
- 自动生成基于菜单结构的面包屑
- 支持点击导航到上级页面

## 菜单结构对比

### 管理员菜单
```
├── 工作台
├── 案源机构管理
│   ├── 机构列表
│   ├── 地理分布
│   ├── 案件统计
│   ├── 合作管理
│   ├── API管理
│   └── 质量分析
├── 处置机构管理
│   ├── 机构列表
│   ├── 地理分布
│   ├── 业绩统计
│   ├── 产能管理
│   ├── 资源管理
│   └── 会员管理
├── 机构审核中心
│   ├── 审核仪表板
│   ├── 申请审核
│   ├── 文件审核
│   └── 风险评估
├── 案件管理
├── 合同管理
├── 报表分析
└── 系统管理
```

### 案源机构菜单
```
├── 工作台
├── 我的机构
│   ├── 机构信息
│   ├── API配置
│   └── 合作状态
├── 案件发布
│   ├── 案件包管理
│   ├── 发布模板
│   └── 质量检查
├── 处置伙伴
│   ├── 机构选择
│   └── 合作业绩
├── 财务管理
│   ├── 账单管理
│   └── 财务报表
└── 数据报表
```

### 处置机构菜单
```
├── 工作台
├── 我的机构
│   ├── 机构信息
│   ├── 产能管理
│   ├── 团队管理
│   └── 会员中心
├── 案件市场
│   ├── 浏览案件
│   ├── 竞标管理
│   └── 承接案件
├── 案件处置
│   ├── 处理中案件
│   ├── 已完成案件
│   └── 处置时间线
├── 案源伙伴
│   ├── 合作状态
│   └── 合作评价
├── 业绩管理
│   ├── 业绩统计
│   └── 业绩分析
└── 财务管理
```

## 技术实现

### 用户状态管理
更新 `authStore.ts`，添加 `type` 字段区分用户类型：
```typescript
interface UserInfo {
  type: 'admin' | 'source_org' | 'disposal_org';
  // ... 其他字段
}
```

### 菜单配置系统
```typescript
export const getMenuConfigByUserType = (userType: 'admin' | 'source_org' | 'disposal_org'): MenuItem[] => {
  // 根据用户类型返回对应菜单配置
}
```

### 路由权限控制
```typescript
export const getRoutesByUserType = (userType: 'admin' | 'source_org' | 'disposal_org'): RouteObject[] => {
  // 根据用户类型返回对应路由配置
}
```

## 使用方法

### 1. 用户登录后自动应用对应菜单
系统会根据 `user.type` 字段自动加载对应的菜单和路由配置。

### 2. 开发模式自动登录
在开发环境中，系统会自动使用管理员身份登录，可以在 `App.tsx` 中修改 `SKIP_LOGIN_IN_DEV` 和模拟用户数据来测试不同用户类型。

### 3. 切换用户类型测试
修改 `App.tsx` 中的模拟用户数据：
```javascript
const mockUserInfo = {
  // ...
  type: 'source_org', // 或 'disposal_org'
  // ...
};
```

## 后续扩展

### 1. 动态权限控制
可以基于用户的 `roles` 和 `permissions` 进一步细化菜单项的显示和路由访问权限。

### 2. 菜单个性化
支持用户自定义菜单排序、隐藏不常用功能等。

### 3. 多角色支持
一个用户可能同时具有多种角色，需要支持角色切换功能。

## 注意事项

1. **路径映射**: 确保 `tsconfig.json` 中的路径映射正确配置
2. **组件导入**: 所有路由组件都需要正确导入到 `routeConfig.tsx`
3. **菜单图标**: 确保菜单配置中使用的图标已正确导入
4. **权限验证**: 在实际使用中需要添加后端权限验证

## 兼容性

此重构保持了现有组件的完整性，不会影响已有功能的正常使用。新的菜单和路由系统是向后兼容的。